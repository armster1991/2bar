<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora de Ângulo 2 Barras - Gunbound</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

  body {
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: linear-gradient(90deg, #2b2f4a 0%, #1c2137 100%);
    font-family: 'Share Tech Mono', monospace;
    color: white;
    overflow: hidden;
    position: relative;
  }

  header {
    text-align: center;
    margin: 1rem auto 2rem;
    font-size: 3rem;
    letter-spacing: 2px;
    user-select: none;
  }

  .angle-display {
    font-weight: bold;
    color: #a2d5f2;
    text-shadow: 0 0 5px #4a90e2;
  }

  /* Régua */
  .ruler-container {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    width: 800px;
    height: 40px;
    background: linear-gradient(90deg, #3a4a68 0%, #2c3a59 100%);
    border-radius: 10px;
    box-shadow: 0 0 10px #3a4a68;
    display: flex;
    user-select: none;
  }

  .ruler-segment {
    flex: 1;
    border-right: 1px solid #556a8a;
    position: relative;
    cursor: pointer;
  }
  .ruler-segment:last-child {
    border-right: none;
  }

  .ruler-segment:hover,
  .ruler-segment.active {
    background: #4db6ac;
    box-shadow: 0 0 10px #26a69a;
  }

  .ruler-segment.illuminated {
    background: #4db6ac;
  }

  /* Barra iluminada da régua até o mouse */
  .ruler-fill {
    position: absolute;
    height: 100%;
    top: 0;
    left: 0;
    background: linear-gradient(90deg, #26a69a 0%, #4db6ac 100%);
    pointer-events: none;
    border-radius: 10px 0 0 10px;
    z-index: 1;
    transition: width 0.1s ease-out;
  }

  /* Container dos botões vento */
  .wind-container {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    height: 70vh;
    user-select: none;
    font-weight: bold;
    font-size: 1rem;
  }

  .wind-side {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    gap: 6px;
    height: 100%;
  }

  .wind-side.left {
    left: 10px;
  }

  .wind-side.right {
    right: 10px;
  }

  .wind-button {
    padding: 6px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: box-shadow 0.3s ease;
    text-align: center;
    color: white;
    user-select: none;
  }

  /* Cores vento a favor (verde) e contra (vermelho) */
  .wind-favor {
    background: linear-gradient(135deg, #00796b, #004d40);
  }
  .wind-contra {
    background: linear-gradient(135deg, #b71c1c, #7f0000);
  }

  /* Pulsar animado quando ativo */
  @keyframes pulse-green {
    0%, 100% { box-shadow: 0 0 8px #26a69a; }
    50% { box-shadow: 0 0 20px #4db6ac; }
  }
  @keyframes pulse-red {
    0%, 100% { box-shadow: 0 0 8px #e53935; }
    50% { box-shadow: 0 0 20px #ef5350; }
  }
  .active-favor {
    animation: pulse-green 1.5s infinite;
  }
  .active-contra {
    animation: pulse-red 1.5s infinite;
  }
</style>
</head>
<body>

<header>
  Ângulo: <span id="angleResult" class="angle-display">--</span>°
</header>

<div class="ruler-container" id="ruler">
  <!-- 20 segmentos da régua serão criados via JS -->
  <div id="rulerFill" class="ruler-fill" style="width:0;"></div>
</div>

<div class="wind-container">
  <div class="wind-side left" id="windContra"></div>
  <div class="wind-side right" id="windFavor"></div>
</div>

<script type="module">
import { calcularAngulo } from './calculoAngulo.js';

const ruler = document.getElementById('ruler');
const angleResult = document.getElementById('angleResult');
const windContra = document.getElementById('windContra');
const windFavor = document.getElementById('windFavor');
const rulerFill = document.getElementById('rulerFill');

const RULER_WIDTH = 800;
const SEGMENTS = 20;

let selectedDistance = null; // em px
let selectedWind = null; // objeto { valor: 0-26, lado: 'favor' | 'contra' }

function criarRulerSegments() {
  for(let i=0; i<SEGMENTS; i++) {
    const seg = document.createElement('div');
    seg.classList.add('ruler-segment');
    seg.dataset.index = i;
    ruler.appendChild(seg);
  }
}

function iluminarRuler(atPx) {
  const percent = Math.min(Math.max(atPx / RULER_WIDTH, 0), 1);
  rulerFill.style.width = (percent * 100) + '%';

  // ativar os segmentos até o hover
  const segments = [...ruler.querySelectorAll('.ruler-segment')];
  segments.forEach((seg, i) => {
    const segStart = (i * RULER_WIDTH) / SEGMENTS;
    if (segStart <= atPx) {
      seg.classList.add('illuminated');
    } else {
      seg.classList.remove('illuminated');
    }
  });
}

function atualizarAngulo() {
  if (selectedDistance === null || selectedWind === null) {
    angleResult.textContent = '--';
    return;
  }
  const ang = calcularAngulo(selectedDistance, selectedWind.valor, selectedWind.lado);
  if (ang === null) {
    angleResult.textContent = '--';
  } else {
    angleResult.textContent = ang.toString().padStart(2,'0');
  }
}

// Eventos régua
ruler.addEventListener('mousemove', (e) => {
  const rect = ruler.getBoundingClientRect();
  const x = e.clientX - rect.left;
  iluminarRuler(x);
  selectedDistance = Math.min(Math.max(x, 0), RULER_WIDTH);
  atualizarAngulo();
});

ruler.addEventListener('mouseleave', () => {
  rulerFill.style.width = '0';
  selectedDistance = null;
  atualizarAngulo();
});

// Criar botões vento
function criarBotoesVento() {
  for(let v=0; v<=26; v++) {
    // Contra vento (esquerda)
    const btnContra = document.createElement('button');
    btnContra.textContent = v;
    btnContra.className = 'wind-button wind-contra';
    btnContra.addEventListener('click', () => {
      selectedWind = { valor: v, lado: 'contra' };
      atualizarAngulo();
      destacarBotao(selectedWind);
    });
    windContra.appendChild(btnContra);

    // Favor vento (direita)
    const btnFavor = document.createElement('button');
    btnFavor.textContent = v;
    btnFavor.className = 'wind-button wind-favor';
    btnFavor.addEventListener('click', () => {
      selectedWind = { valor: v, lado: 'favor' };
      atualizarAngulo();
      destacarBotao(selectedWind);
    });
    windFavor.appendChild(btnFavor);
  }
}

function destacarBotao(wind) {
  // Remove classes active
  document.querySelectorAll('.wind-button').forEach(b => {
    b.classList.remove('active-favor', 'active-contra');
  });
  if (!wind) return;

  const container = wind.lado === 'favor' ? windFavor : windContra;
  for(const btn of container.children) {
    if (btn.textContent == wind.valor) {
      btn.classList.add(wind.lado === 'favor' ? 'active-favor' : 'active-contra');
    }
  }
}

criarRulerSegments();
criarBotoesVento();

</script>

</body>
</html>
